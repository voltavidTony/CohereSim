# CohereSim

[TOC]

## About

CohereSim is aimed at providing runtime metrics of a DSM processor to enhance education in computer architecture, wherein it enables students to compare a variety of caches and draw conclusions about the impact of the cache size, line size, associativity, coherence protocol and replacement policy.

- Course: NC State University CSC/ECE 506
- Instructor: Ed Gehringer
- Email: efg@ncsu.edu

| Version | Programmer | Description |
|:-|-|-|
| 1.0 | Ahmad Samih & Yan Solihin | Initial Version |
| 2.0 | Ed Gehringer | Revised for Spring 2015 |
| 3.0 | Anthony Spendlove | Complete rewrite for Spring 2025 |
| 3.1 | Anthony Spendlove | Add batch mode (parallel execution) |
| 3.1.1 | Anthony Spendlove | Trace file chunks are "double buffered" in batch mode |
| 3.2 | Anthony Spendlove | Added write timestamp debugging feature, consistency refactorings, bugfixes, portability and cross-platform edits |
| 3.3 | Anthony Spendlove | Added directory protocol program structure |

(Version history begins with v3.0)

This software operates under the GNU General Public License v3.0.

The repo is found on [my GitHub](https://github.com/voltavidTony/CohereSim). A copy of this documentation is hosted on [my GitHub Pages](https://voltavidtony.github.io/docs/CohereSim/index.html).

## Roadmap

- Implement Directory Protocols
- Compressed Trace Files
- More Protocols and Policies

## CohereSim Simulator

### Installation

This repository uses sub-modules to generate trace files for the simulation. If you do not wish to generate trace files, then the sub-modules can be left empty (uninitialized). If you do want to generate trace files, then:

- If you already downloaded this repo, then run `git submodule update --init` from the root directory.
- If not, then simply include the `--recurse-submodules` option in the `git clone` command.

### Build & Run

The provided make file in the root directory is used to build CohereSim. It currently has four targets:

- `all`: (Incremental) build, default target
- `rebuild`: Fully re-compile all source files
- `clean`: Remove files generated by the build and run process
- `*.bin`: Run CohereSim in batch metrics mode, using `configs.txt` as the configuration list and `*.bin` as the trace file

For more information on running CohereSim and its modes of operation, see the [CohereSim manual](docs/pages/cache_sim.md).

### Development

For further development, a [development manual](docs/pages/development.md) is included in this documentation.

## Tool Suite

### Doxygen Documentation

The codebase and tool suite are documented using Doxygen style comments. As such, the Doxyfile is provided at the root directory and configured to generate HTML documentation of this software suite. To generate this documentation, simply issue `doxygen` on the command line in the same directory as this file. The resulting documentation will be available at `docs/html/index.html`.

### Template File Generation

CohereSim was built to be extended, and thus template files and a template generator script are provided to automate the boilerplate code.

See the [template file generation guide](docs/pages/templates.md) to learn how to create new source files using the provided templates.

### Trace File Generation

CohereSim reads in memory trace files to simulate cache behavior and record statistics. These are binary files comprised of a series of 5-byte memory accesses. Each memory access is structured as follows:

- The first 7 bits (7 high bits) are the CPU core ID that performs the memory access
- The 8th bit (LSB) is the operation (1 = write, 0 = read)
- The remaining 4 bytes are the 32-bit memory address accessed, stored in little endian byte ordering

For example, a trace of `09 70 7D 11 00` evaluates to a write operation by CPU core 4 at address 0x00117D70.

See the [trace file generation guide](docs/pages/gen_traces.md) to learn how to create your own trace files.

## Folder Structure

| Path ||| Description |
| - | - | - | - |
| ğŸ— bin/ ||| Build directory |
| ğŸ“‚ docs/ ||| Documentation files |
| | ğŸ— html/ || Generated HTML documentation |
| | ğŸ“‚ pages/ || Custom documentation pages |
| | | ğŸ“„ cache_sim.md | CohereSim operation manual |
| | | ğŸ“„ development.md | Developer manual |
| | | ğŸ“„ exit_codes.md | CohereSim exit code explanation |
| | | ğŸ“„ gen_traces.md | Trace file generation manual |
| | | ğŸ“„ templates.md | Template file generation manual |
| | ğŸ“„ custom_doxygen.css || Stylesheet for doxygen documentation |
| ğŸ“‚ src/ ||| CohereSim source files ([see file list](files.html)) |
| ğŸ“‚ template/ ||| Template files & generator script |
| | ğŸ“„ coherence_c.tmplt || Coherence protocol source file template |
| | ğŸ“„ coherence_h.tmplt || Coherence protocol header file template |
| | ğŸ“„ directory_c.tmplt || Directory protocol source file template |
| | ğŸ“„ directory_h.tmplt || Directory protocol header file template |
| | ğŸ“„ interactive_c.tmplt || Interactive mode source file template |
| | ğŸ“„ interactive_h.tmplt || Interactive mode header file template |
| | ğŸ“œ mksrc.sh || Source file generator script |
| | ğŸ“„ replacement_c.tmplt || Replacement policy source file template |
| | ğŸ“„ replacement_h.tmplt || Replacement policy header file template |
| ğŸ“‚ tools/ ||| First- and third-party tool suite for trace file generation |
| | ğŸ“¦ gem5/ || gem5 computer hardware simulator |
| | ğŸ“¦ parsec-benchmark/ || PARSEC benchmark suite |
| | ğŸ“„ extractor.c || Translator program from gem5 output into trace file binary format |
| | ğŸ“œ gem5_config.py || gem5 configuration for trace file generation |
| | ğŸ“œ gen_trace.sh || Trace file generation script |
| | ğŸ“œ get_platform.sh || Platform string generator |
| ğŸ— traces/ ||| Generated trace files |
| ğŸ“„ .gitignore ||| Git ignore list |
| ğŸ“„ .gitmodules ||| Git sub-module list |
| ğŸ“„ configs.txt ||| Example configs file |
| ğŸ“œ Doxyfile ||| Doxygen script for generating documentation |
| ğŸ”— index.html ||| Link to generated HTML documentation |
| ğŸ“„ LICENSE ||| License file |
| ğŸ“œ Makefile ||| Make script for building and running CohereSim |
| ğŸ“„ README.md ||| Readme file |
| ğŸ“„ sequence7.2.txt ||| Cache line access sequence from the textbook |
| ğŸ“„ sequence7.6.txt ||| Cache line access sequence from the textbook |

- ğŸ“‚: Folder
- ğŸ—: Folder excluded by .gitignore
- ğŸ“¦: GitHub sub-module
- ğŸ“„: File
- ğŸ“œ: Script file
- ğŸ”—: Link to file
